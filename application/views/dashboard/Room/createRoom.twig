{% extends 'dashboard/layout.twig' %}

{% block content %}
<div class="main-content d-flex flex-column min-vh-100">
    <div class="container py-5">
        <main>
            <div class="mx-auto max-w-4xl py-7 px-7">
                <h2 class="mb-4">Create Room</h2>
                <form method="POST" action="{{ base_url('rooms/store') }}">

                    <div class="mb-4">
                        <label for="room_number">Room Number</label>
                        <input type="number" id="room_number" name="room_number" required class="form-control">
                    </div>

                    <div class="mb-4">
                        <label for="floor">Floor</label>
                        <input type="number" id="floor" name="floor" required class="form-control">
                    </div>

                    <div class="mb-4">
                        <label for="beds">Beds</label>
                        <input type="number" id="beds" name="beds" required class="form-control">
                    </div>

                    <div class="mb-4">
                        <label for="max_guests">Max Guests</label>
                        <input type="number" id="max_guests" name="max_guests" required class="form-control">
                    </div>

                    <!-- Hotel Select -->
                    <div class="mb-4 position-relative">
                        <label for="hotelSearch" class="form-label fw-semibold">Select Hotel</label>
                        <input type="text" class="form-control" id="hotelSearch" placeholder="Search or Select Hotel..." autocomplete="off">
                        <input type="hidden" name="hotel_id" id="hotel_id">

                        <ul class="list-group position-absolute w-100 shadow-sm mt-1" id="hotelList" style="display:none; max-height:200px; overflow-y:auto; z-index:1050;">
                            {% for hotel in hotels %}
                                <li class="list-group-item list-group-item-action" data-id="{{ hotel.id }}">{{ hotel.hotel_name }}</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="mb-4">
                        <label for="status">Status</label>
                        <select id="status" name="status" required class="form-control">
                            <option value="available">Available</option>
                            <option value="booked">Booked</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>

                    <div class="mt-6 flex items-center justify-end gap-x-4">
                        <a href="{{ base_url('rooms') }}">Cancel</a>
                        <button type="submit" class="btn btn-success">Create</button>
                    </div>

                </form>
            </div>
        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
$(function(){
    const $input = $('#hotelSearch');
    const $list = $('#hotelList');

    // Show list on focus
    $input.on('focus click', function(){
        $list.show();
    });

    // Filter hotels
    $input.on('input', function(){
        const query = this.value.toLowerCase();
        $list.children('li').each(function(){
            $(this).toggle($(this).text().toLowerCase().includes(query));
        });
    });

    // Select hotel
    $list.on('click', 'li', function(){
        $input.val($(this).text());
        $('#hotel_id').val($(this).data('id'));
        $list.hide();
    });

    // Hide on outside click
    $(document).on('click', function(e){
        if(!$(e.target).closest('.position-relative').length){
            $list.hide();
        }
    });
});
</script>
{% endblock %}
